(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{9495:function(e,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[id]/modifier",function(){return o(345)}])},4126:function(e,n,o){"use strict";o.d(n,{O:function(){return i}});var r=o(8967);let i=(0,r.eI)("https://fkavtsofmglifzalclyn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrYXZ0c29mbWdsaWZ6YWxjbHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5MDgzNDIsImV4cCI6MjA1ODQ4NDM0Mn0.vN8-2RzyVu_2X4lWT4Uqa6aI3OYuAcIFFuMeGS5Po1Y")},345:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return a}});var r=o(5893),i=o(1163),t=o(7294),s=o(4126);function a(){let e=(0,i.useRouter)(),{id:n}=e.query,[o,a]=(0,t.useState)({titre:"",ville:"",prix:"",surface_m2:"",dpe:"",description:"",honoraires:"",disponible:!0,sous_compromis:!1,vendu:!1,export_leboncoin:!1,export_seloger:!1}),[l,c]=(0,t.useState)("");(0,t.useEffect)(()=>{if(!n)return;let e=async()=>{let{data:e}=await s.O.from("biens").select("*").eq("id",n).single();if(e){a(e);let{data:n}=s.O.storage.from("photos-biens").getPublicUrl("".concat(e.id,"/main.jpg"));c((null==n?void 0:n.publicUrl)||"")}};e()},[n]);let u=e=>{let{name:n,value:r,type:i,checked:t}=e.target;a({...o,[n]:"checkbox"===i?t:r})},p=async e=>{let o="".concat(n,"/main.jpg"),{error:r}=await s.O.storage.from("photos-biens").upload(o,e,{upsert:!0});if(!r){let{data:e}=s.O.storage.from("photos-biens").getPublicUrl(o);c(null==e?void 0:e.publicUrl)}},d=async()=>{let e="R\xe9dige une description immobili\xe8re pour un bien \xe0 ".concat(o.ville,', type "').concat(o.titre,'", ').concat(o.surface_m2," m\xb2, DPE ").concat(o.dpe,", au prix de ").concat(o.prix," €."),n=await fetch("/api/generate-description",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})}),r=await n.json();r.text&&a(e=>({...e,description:r.text}))},m=async r=>{r.preventDefault();let{error:i}=await s.O.from("biens").update({...o,prix:Number(o.prix),surface_m2:Number(o.surface_m2),honoraires:Number(o.honoraires)}).eq("id",n);if(i)alert("❌ Erreur mise \xe0 jour"),console.error(i);else{var t,a;let n=null===(a=document.querySelector("#photo-upload"))||void 0===a?void 0:null===(t=a.files)||void 0===t?void 0:t[0];n&&await p(n),alert("✅ Bien modifi\xe9"),e.push("/biens")}};return o.titre?(0,r.jsxs)("div",{className:"p-8 max-w-2xl mx-auto bg-white rounded shadow mt-8 space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"✏️ Modifier un bien"}),(0,r.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,r.jsx)("input",{name:"titre",value:o.titre,onChange:u,placeholder:"Titre",className:"w-full p-2 border rounded"}),(0,r.jsx)("input",{name:"ville",value:o.ville,onChange:u,placeholder:"Ville",className:"w-full p-2 border rounded"}),(0,r.jsx)("input",{type:"number",name:"prix",value:o.prix,onChange:u,placeholder:"Prix (€)",className:"w-full p-2 border rounded"}),(0,r.jsx)("input",{type:"number",name:"surface_m2",value:o.surface_m2,onChange:u,placeholder:"Surface (m\xb2)",className:"w-full p-2 border rounded"}),(0,r.jsx)("input",{name:"dpe",value:o.dpe,onChange:u,placeholder:"DPE",className:"w-full p-2 border rounded"}),(0,r.jsx)("input",{type:"number",name:"honoraires",value:o.honoraires,onChange:u,placeholder:"Honoraires (€)",className:"w-full p-2 border rounded"}),(0,r.jsx)("textarea",{name:"description",value:o.description,onChange:u,placeholder:"Description compl\xe8te",rows:"4",className:"w-full p-2 border rounded"}),(0,r.jsx)("button",{type:"button",onClick:d,className:"bg-gray-200 text-sm px-2 py-1 rounded hover:bg-gray-300",children:"✨ G\xe9n\xe9rer automatiquement"}),l&&(0,r.jsx)("img",{src:l,alt:"Photo",className:"w-full rounded shadow"}),(0,r.jsx)("input",{id:"photo-upload",type:"file",accept:"image/*",className:"block mt-2"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",name:"disponible",checked:o.disponible,onChange:u})," Disponible"]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",name:"sous_compromis",checked:o.sous_compromis,onChange:u})," Sous compromis"]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",name:"vendu",checked:o.vendu,onChange:u})," Vendu"]})]}),(0,r.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"\uD83C\uDF10 Export :"}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",name:"export_leboncoin",checked:o.export_leboncoin,onChange:u})," LeBonCoin"]}),(0,r.jsx)("br",{}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"checkbox",name:"export_seloger",checked:o.export_seloger,onChange:u})," SeLoger"]})]}),(0,r.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"\uD83D\uDCBE Enregistrer"})]})]}):(0,r.jsx)("div",{className:"p-8",children:"Chargement..."})}},1163:function(e,n,o){e.exports=o(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9495)}),_N_E=e.O()}]);