(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[593],{7972:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/ajouter",function(){return r(1926)}])},4126:function(e,n,r){"use strict";r.d(n,{O:function(){return s}});var o=r(8967);let s=(0,o.eI)("https://fkavtsofmglifzalclyn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrYXZ0c29mbWdsaWZ6YWxjbHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5MDgzNDIsImV4cCI6MjA1ODQ4NDM0Mn0.vN8-2RzyVu_2X4lWT4Uqa6aI3OYuAcIFFuMeGS5Po1Y")},1926:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return l}});var o=r(5893),s=r(7294),a=r(1163),i=r(4126);function l(){let[e,n]=(0,s.useState)({titre:"",ville:"",prix:"",surface_m2:"",dpe:"",honoraires:"",description:"",disponible:!0,sous_compromis:!1,vendu:!1,export_leboncoin:!1,export_seloger:!1}),[r,l]=(0,s.useState)(null),t=(0,a.useRouter)();(0,s.useEffect)(()=>{let e=async()=>{let{data:{session:e}}=await i.O.auth.getSession();(null==e?void 0:e.user)?l(e.user.id):t.push("/login")};e()},[]);let u=r=>{let{name:o,value:s,type:a,checked:i}=r.target;n({...e,[o]:"checkbox"===a?i:s})},c=async(e,n)=>{let{error:r}=await i.O.storage.from("photos-biens").upload("".concat(n,"/main.jpg"),e,{upsert:!0});r?console.error("❌ Erreur upload image :",r):console.log("✅ Image upload\xe9e")},d=async n=>{var o,s;if(n.preventDefault(),!r){alert("Utilisateur non connect\xe9.");return}let a={...e,agent_id:r,prix:Number(e.prix),surface_m2:Number(e.surface_m2),honoraires:Number(e.honoraires)};console.log("\uD83D\uDCE4 Donn\xe9es envoy\xe9es \xe0 Supabase :",a);let{error:l}=await i.O.from("biens").insert([a]);if(l){console.error("❌ Erreur Supabase :",l),alert("❌ Erreur \xe0 l’insertion");return}let{data:u,error:d}=await i.O.from("biens").select("id").eq("agent_id",r).order("created_at",{ascending:!1}).limit(1);if(d||!u||0===u.length){console.warn("⚠️ Bien ajout\xe9 mais ID non trouv\xe9 pour upload image."),alert("✅ Bien ajout\xe9 (image non li\xe9e)"),t.push("/biens");return}let p=u[0].id,m=null===(s=document.querySelector("#photo-upload"))||void 0===s?void 0:null===(o=s.files)||void 0===o?void 0:o[0];m&&p&&await c(m,p),alert("✅ Bien ajout\xe9 avec succ\xe8s"),t.push("/biens")};return(0,o.jsxs)("div",{className:"max-w-2xl mx-auto p-6 mt-8 bg-white rounded shadow",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"➕ Ajouter un bien"}),(0,o.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,o.jsx)("input",{name:"titre",value:e.titre,onChange:u,placeholder:"Titre",required:!0,className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{name:"ville",value:e.ville,onChange:u,placeholder:"Ville",required:!0,className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"prix",value:e.prix,onChange:u,placeholder:"Prix (€)",required:!0,className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"surface_m2",value:e.surface_m2,onChange:u,placeholder:"Surface (m\xb2)",required:!0,className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{name:"dpe",value:e.dpe,onChange:u,placeholder:"DPE",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"honoraires",value:e.honoraires,onChange:u,placeholder:"Honoraires (€)",required:!0,className:"w-full p-2 border rounded"}),(0,o.jsx)("textarea",{name:"description",value:e.description,onChange:u,placeholder:"Description (optionnelle)",rows:"4",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{id:"photo-upload",type:"file",accept:"image/*",className:"block mt-2"}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"disponible",checked:e.disponible,onChange:u})," Disponible"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"sous_compromis",checked:e.sous_compromis,onChange:u})," Sous compromis"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"vendu",checked:e.vendu,onChange:u})," Vendu"]})]}),(0,o.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,o.jsx)("p",{className:"font-semibold mb-2",children:"\uD83C\uDF10 Export :"}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"export_leboncoin",checked:e.export_leboncoin,onChange:u})," LeBonCoin"]}),(0,o.jsx)("br",{}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"export_seloger",checked:e.export_seloger,onChange:u})," SeLoger"]})]}),(0,o.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mt-4",children:"\uD83D\uDCBE Enregistrer le bien"})]})]})}},1163:function(e,n,r){e.exports=r(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=7972)}),_N_E=e.O()}]);